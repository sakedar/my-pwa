<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Music Player</title>
<link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #000;
    --card: rgba(255,255,255,0.08);
    --text: #fff;
    --sub: rgba(255,255,255,0.5);
    --accent: #fc3c44;
    --blur: blur(40px);
  }

  body {
    font-family: -apple-system, 'SF Pro Display', sans-serif;
    background: #0a0a0a;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
  }

  /* Ambient background */
  .ambient {
    position: fixed;
    inset: 0;
    z-index: 0;
    transition: background 1.5s ease;
    filter: blur(80px) saturate(2);
    opacity: 0.4;
    transform: scale(1.2);
  }

  .phone {
    position: relative;
    z-index: 10;
    width: 390px;
    height: 844px;
    background: rgba(15,15,15,0.95);
    border-radius: 54px;
    overflow: hidden;
    box-shadow:
      0 0 0 1.5px rgba(255,255,255,0.12),
      0 60px 120px rgba(0,0,0,0.8),
      inset 0 1px 0 rgba(255,255,255,0.08);
    backdrop-filter: blur(20px);
  }

  /* Dynamic Island */
  .dynamic-island {
    position: absolute;
    top: 14px;
    left: 50%;
    transform: translateX(-50%);
    width: 126px;
    height: 37px;
    background: #000;
    border-radius: 20px;
    z-index: 100;
    box-shadow: 0 0 0 1px rgba(255,255,255,0.06);
    transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    overflow: hidden;
  }

  .dynamic-island .di-content {
    display: flex;
    align-items: center;
    gap: 8px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .dynamic-island.playing { width: 300px; height: 50px; }
  .dynamic-island.playing .di-content { opacity: 1; }

  .di-mini-art {
    width: 32px;
    height: 32px;
    border-radius: 7px;
    background: linear-gradient(135deg, #fc3c44, #ff6b35);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    flex-shrink: 0;
  }

  .di-info { flex: 1; overflow: hidden; }
  .di-title { font-size: 11px; color: #fff; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .di-artist { font-size: 10px; color: rgba(255,255,255,0.5); white-space: nowrap; }

  .di-wave {
    display: flex;
    align-items: center;
    gap: 2px;
    margin-right: 4px;
  }
  .di-wave span {
    width: 3px;
    background: var(--accent);
    border-radius: 2px;
    animation: wave 1s ease-in-out infinite;
  }
  .di-wave span:nth-child(1) { height: 10px; animation-delay: 0s; }
  .di-wave span:nth-child(2) { height: 18px; animation-delay: 0.15s; }
  .di-wave span:nth-child(3) { height: 14px; animation-delay: 0.3s; }
  .di-wave span:nth-child(4) { height: 20px; animation-delay: 0.1s; }

  @keyframes wave {
    0%, 100% { transform: scaleY(0.5); }
    50% { transform: scaleY(1); }
  }

  /* Screen content */
  .screen {
    width: 100%;
    height: 100%;
    display: flex;
    flex-direction: column;
    padding: 60px 24px 40px;
  }

  /* Tab bar */
  .tabs {
    display: flex;
    gap: 0;
    margin-bottom: 24px;
    background: rgba(255,255,255,0.06);
    border-radius: 14px;
    padding: 3px;
  }
  .tab {
    flex: 1;
    padding: 8px;
    text-align: center;
    font-size: 12px;
    font-weight: 500;
    color: var(--sub);
    border-radius: 11px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .tab.active {
    background: rgba(255,255,255,0.12);
    color: #fff;
  }

  /* Views */
  .view { display: none; flex: 1; flex-direction: column; }
  .view.active { display: flex; }

  /* Now Playing */
  .np-art-container {
    display: flex;
    justify-content: center;
    margin-bottom: 32px;
    margin-top: 12px;
  }

  .np-art {
    width: 270px;
    height: 270px;
    border-radius: 22px;
    box-shadow: 0 30px 60px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.05);
    overflow: hidden;
    position: relative;
    transition: transform 0.4s cubic-bezier(0.34, 1.56, 0.64, 1), box-shadow 0.4s;
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 80px;
  }

  .np-art.playing {
    transform: scale(1.06);
    box-shadow: 0 40px 80px rgba(0,0,0,0.7), 0 0 0 1px rgba(255,255,255,0.08);
  }

  .np-meta {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }

  .np-titles { flex: 1; }
  .np-title {
    font-size: 22px;
    font-weight: 700;
    color: #fff;
    letter-spacing: -0.5px;
    line-height: 1.2;
  }
  .np-artist {
    font-size: 17px;
    color: var(--accent);
    font-weight: 500;
    margin-top: 4px;
  }

  .heart-btn {
    background: none;
    border: none;
    color: var(--sub);
    font-size: 22px;
    cursor: pointer;
    padding: 8px;
    transition: all 0.2s;
  }
  .heart-btn.liked { color: var(--accent); }
  .heart-btn:active { transform: scale(1.3); }

  /* Progress */
  .progress-section { margin-bottom: 20px; }
  .progress-bar-container {
    height: 5px;
    background: rgba(255,255,255,0.15);
    border-radius: 3px;
    cursor: pointer;
    margin-bottom: 8px;
    position: relative;
    overflow: visible;
  }
  .progress-fill {
    height: 100%;
    background: #fff;
    border-radius: 3px;
    position: relative;
    transition: width 0.1s linear;
  }
  .progress-thumb {
    width: 14px;
    height: 14px;
    background: #fff;
    border-radius: 50%;
    position: absolute;
    right: -7px;
    top: -4.5px;
    box-shadow: 0 1px 4px rgba(0,0,0,0.4);
    opacity: 0;
    transition: opacity 0.2s;
  }
  .progress-bar-container:hover .progress-thumb { opacity: 1; }

  .progress-times {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: var(--sub);
    font-weight: 500;
    font-variant-numeric: tabular-nums;
  }

  /* Controls */
  .controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 28px;
  }

  .ctrl-btn {
    background: none;
    border: none;
    color: #fff;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: opacity 0.15s, transform 0.15s;
    padding: 8px;
  }
  .ctrl-btn:active { opacity: 0.6; transform: scale(0.92); }

  .ctrl-btn.secondary { opacity: 0.7; }
  .ctrl-btn.secondary:hover { opacity: 1; }

  .play-btn {
    width: 72px;
    height: 72px;
    background: #fff;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 8px 24px rgba(0,0,0,0.4);
    transition: transform 0.2s cubic-bezier(0.34,1.56,0.64,1), opacity 0.1s;
  }
  .play-btn:active { transform: scale(0.93); }
  .play-btn svg { color: #000; }

  /* Volume */
  .volume-section {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 28px;
  }
  .vol-icon { color: var(--sub); }
  .volume-slider {
    flex: 1;
    -webkit-appearance: none;
    height: 5px;
    background: rgba(255,255,255,0.2);
    border-radius: 3px;
    outline: none;
    cursor: pointer;
  }
  .volume-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 16px; height: 16px;
    background: #fff;
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 1px 4px rgba(0,0,0,0.3);
  }

  /* Bottom actions */
  .bottom-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  .act-btn {
    background: none;
    border: none;
    color: var(--sub);
    cursor: pointer;
    font-size: 18px;
    padding: 8px;
    transition: color 0.2s;
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    font-weight: 500;
  }
  .act-btn:hover { color: #fff; }
  .act-btn.active { color: var(--accent); }

  /* Library View */
  .lib-header {
    font-size: 30px;
    font-weight: 800;
    color: #fff;
    letter-spacing: -0.8px;
    margin-bottom: 16px;
  }

  .search-bar {
    display: flex;
    align-items: center;
    background: rgba(255,255,255,0.1);
    border-radius: 12px;
    padding: 10px 14px;
    gap: 8px;
    margin-bottom: 20px;
  }
  .search-bar input {
    background: none;
    border: none;
    color: #fff;
    font-size: 15px;
    outline: none;
    flex: 1;
    font-family: inherit;
  }
  .search-bar input::placeholder { color: var(--sub); }

  .song-list { flex: 1; overflow-y: auto; scrollbar-width: none; }
  .song-list::-webkit-scrollbar { display: none; }

  .song-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 10px 0;
    cursor: pointer;
    border-bottom: 1px solid rgba(255,255,255,0.05);
    transition: opacity 0.15s;
  }
  .song-item:active { opacity: 0.6; }
  .song-item:last-child { border-bottom: none; }

  .song-art {
    width: 52px; height: 52px;
    border-radius: 10px;
    background: linear-gradient(135deg, #1a1a2e, #16213e);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    flex-shrink: 0;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
  }
  .song-info { flex: 1; overflow: hidden; }
  .song-name {
    font-size: 15px;
    font-weight: 500;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .song-name.playing-now { color: var(--accent); }
  .song-meta {
    font-size: 13px;
    color: var(--sub);
    margin-top: 2px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .song-duration {
    font-size: 13px;
    color: var(--sub);
    font-variant-numeric: tabular-nums;
    flex-shrink: 0;
  }

  /* Playing indicator in list */
  .playing-bars {
    display: flex;
    align-items: flex-end;
    gap: 2px;
    height: 16px;
    margin-right: 4px;
  }
  .playing-bars span {
    width: 3px;
    background: var(--accent);
    border-radius: 2px;
    animation: wave 1s ease-in-out infinite;
  }
  .playing-bars span:nth-child(1) { height: 8px; animation-delay: 0s; }
  .playing-bars span:nth-child(2) { height: 14px; animation-delay: 0.2s; }
  .playing-bars span:nth-child(3) { height: 10px; animation-delay: 0.1s; }

  /* Nav bar */
  .nav-bar {
    position: absolute;
    bottom: 0;
    left: 0; right: 0;
    height: 84px;
    background: rgba(20,20,20,0.95);
    backdrop-filter: blur(20px);
    border-top: 1px solid rgba(255,255,255,0.06);
    display: flex;
    align-items: flex-start;
    justify-content: space-around;
    padding-top: 12px;
    z-index: 50;
  }

  .nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 4px;
    cursor: pointer;
    padding: 4px 16px;
    transition: opacity 0.2s;
    color: var(--sub);
  }
  .nav-item.active { color: var(--accent); }
  .nav-item svg { width: 24px; height: 24px; }
  .nav-item span { font-size: 10px; font-weight: 500; }

  /* Mini player */
  .mini-player {
    position: absolute;
    bottom: 84px;
    left: 12px; right: 12px;
    background: rgba(40,40,40,0.98);
    backdrop-filter: blur(30px);
    border-radius: 16px;
    padding: 12px 16px;
    display: flex;
    align-items: center;
    gap: 12px;
    z-index: 49;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    border: 1px solid rgba(255,255,255,0.08);
    cursor: pointer;
    transition: opacity 0.3s;
  }
  .mini-player.hidden { opacity: 0; pointer-events: none; }

  .mini-art {
    width: 44px; height: 44px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    flex-shrink: 0;
  }
  .mini-info { flex: 1; overflow: hidden; }
  .mini-title {
    font-size: 14px;
    font-weight: 600;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .mini-artist {
    font-size: 12px;
    color: var(--sub);
    margin-top: 2px;
  }
  .mini-controls { display: flex; gap: 4px; }
  .mini-btn {
    background: none; border: none;
    color: #fff;
    cursor: pointer;
    padding: 6px;
    transition: opacity 0.15s;
  }
  .mini-btn:active { opacity: 0.5; }

  /* SVG icons inline */
  svg { fill: none; stroke: currentColor; stroke-width: 2; stroke-linecap: round; stroke-linejoin: round; }

  /* Marquee for long song names */
  @keyframes marquee {
    0% { transform: translateX(0); }
    30% { transform: translateX(0); }
    70% { transform: translateX(var(--offset, -60px)); }
    100% { transform: translateX(var(--offset, -60px)); }
  }
</style>
</head>
<body>

<!-- Ambient light -->
<div class="ambient" id="ambient"></div>

<div class="phone">

  <!-- Dynamic Island -->
  <div class="dynamic-island" id="dynamicIsland">
    <div class="di-content" id="diContent">
      <div class="di-mini-art" id="diArt"></div>
      <div class="di-info">
        <div class="di-title" id="diTitle"></div>
        <div class="di-artist" id="diArtist"></div>
      </div>
      <div class="di-wave">
        <span></span><span></span><span></span><span></span>
      </div>
    </div>
  </div>

  <!-- Main screen -->
  <div class="screen">

    <!-- Tabs -->
    <div class="tabs" id="tabs">
      <div class="tab active" data-view="nowplaying">Now Playing</div>
      <div class="tab" data-view="library">Library</div>
    </div>

    <!-- Now Playing View -->
    <div class="view active" id="view-nowplaying">

      <div class="np-art-container">
        <div class="np-art" id="npArt">ðŸŽµ</div>
      </div>

      <div class="np-meta">
        <div class="np-titles">
          <div class="np-title" id="npTitle">No Track Selected</div>
          <div class="np-artist" id="npArtist">Tap a song to play</div>
        </div>
        <button class="heart-btn" id="heartBtn" onclick="toggleLike()">
          <svg width="22" height="22" viewBox="0 0 24 24">
            <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z" stroke-width="2"/>
          </svg>
        </button>
      </div>

      <div class="progress-section">
        <div class="progress-bar-container" id="progressBar" onclick="seekTo(event)">
          <div class="progress-fill" id="progressFill" style="width:0%">
            <div class="progress-thumb"></div>
          </div>
        </div>
        <div class="progress-times">
          <span id="currentTime">0:00</span>
          <span id="totalTime">0:00</span>
        </div>
      </div>

      <div class="controls">
        <!-- Shuffle -->
        <button class="ctrl-btn secondary" id="shuffleBtn" onclick="toggleShuffle()" title="Shuffle">
          <svg width="22" height="22" viewBox="0 0 24 24">
            <polyline points="16 3 21 3 21 8"></polyline>
            <line x1="4" y1="20" x2="21" y2="3"></line>
            <polyline points="21 16 21 21 16 21"></polyline>
            <line x1="15" y1="15" x2="21" y2="21"></line>
          </svg>
        </button>

        <!-- Previous -->
        <button class="ctrl-btn" onclick="prevSong()">
          <svg width="34" height="34" viewBox="0 0 24 24">
            <polygon points="19 20 9 12 19 4 19 20"></polygon>
            <line x1="5" y1="19" x2="5" y2="5"></line>
          </svg>
        </button>

        <!-- Play/Pause -->
        <button class="ctrl-btn play-btn" id="playBtn" onclick="togglePlay()">
          <svg id="playIcon" width="28" height="28" viewBox="0 0 24 24" fill="#000" stroke="none">
            <polygon points="5 3 19 12 5 21 5 3"></polygon>
          </svg>
        </button>

        <!-- Next -->
        <button class="ctrl-btn" onclick="nextSong()">
          <svg width="34" height="34" viewBox="0 0 24 24">
            <polygon points="5 4 15 12 5 20 5 4"></polygon>
            <line x1="19" y1="5" x2="19" y2="19"></line>
          </svg>
        </button>

        <!-- Repeat -->
        <button class="ctrl-btn secondary" id="repeatBtn" onclick="toggleRepeat()" title="Repeat">
          <svg width="22" height="22" viewBox="0 0 24 24">
            <polyline points="17 1 21 5 17 9"></polyline>
            <path d="M3 11V9a4 4 0 0 1 4-4h14"></path>
            <polyline points="7 23 3 19 7 15"></polyline>
            <path d="M21 13v2a4 4 0 0 1-4 4H3"></path>
          </svg>
        </button>
      </div>

      <!-- Volume -->
      <div class="volume-section">
        <svg class="vol-icon" width="16" height="16" viewBox="0 0 24 24">
          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
        </svg>
        <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="80" oninput="setVolume(this.value)">
        <svg class="vol-icon" width="20" height="20" viewBox="0 0 24 24">
          <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon>
          <path d="M15.54 8.46a5 5 0 0 1 0 7.07"></path>
          <path d="M19.07 4.93a10 10 0 0 1 0 14.14"></path>
        </svg>
      </div>

      <!-- Bottom actions -->
      <div class="bottom-actions">
        <button class="act-btn" id="airplayBtn">
          <svg width="18" height="18" viewBox="0 0 24 24">
            <path d="M5 17H3a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-2"></path>
            <polygon points="12 15 17 21 7 21 12 15"></polygon>
          </svg>
          AirPlay
        </button>
        <button class="act-btn" onclick="shareTrack()">
          <svg width="18" height="18" viewBox="0 0 24 24">
            <circle cx="18" cy="5" r="3"></circle>
            <circle cx="6" cy="12" r="3"></circle>
            <circle cx="18" cy="19" r="3"></circle>
            <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>
            <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>
          </svg>
          Share
        </button>
        <button class="act-btn" onclick="showQueue()">
          <svg width="18" height="18" viewBox="0 0 24 24">
            <line x1="8" y1="6" x2="21" y2="6"></line>
            <line x1="8" y1="12" x2="21" y2="12"></line>
            <line x1="8" y1="18" x2="21" y2="18"></line>
            <line x1="3" y1="6" x2="3.01" y2="6"></line>
            <line x1="3" y1="12" x2="3.01" y2="12"></line>
            <line x1="3" y1="18" x2="3.01" y2="18"></line>
          </svg>
          Queue
        </button>
      </div>
    </div>

    <!-- Library View -->
    <div class="view" id="view-library" style="padding-bottom: 120px;">
      <div class="lib-header">Library</div>
      <div class="search-bar">
        <svg width="16" height="16" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line></svg>
        <input type="text" placeholder="Search songs..." oninput="filterSongs(this.value)">
      </div>
      <div class="song-list" id="songList"></div>
    </div>

  </div><!-- end screen -->

  <!-- Mini player (shown in library view) -->
  <div class="mini-player hidden" id="miniPlayer" onclick="switchTab('nowplaying')">
    <div class="mini-art" id="miniArt">ðŸŽµ</div>
    <div class="mini-info">
      <div class="mini-title" id="miniTitle">Not Playing</div>
      <div class="mini-artist" id="miniArtist">â€”</div>
    </div>
    <div class="mini-controls">
      <button class="mini-btn" onclick="event.stopPropagation(); togglePlay()">
        <svg id="miniPlayIcon" width="22" height="22" viewBox="0 0 24 24" fill="currentColor" stroke="none">
          <polygon points="5 3 19 12 5 21 5 3"></polygon>
        </svg>
      </button>
      <button class="mini-btn" onclick="event.stopPropagation(); nextSong()">
        <svg width="22" height="22" viewBox="0 0 24 24">
          <polygon points="5 4 15 12 5 20 5 4"></polygon>
          <line x1="19" y1="5" x2="19" y2="19"></line>
        </svg>
      </button>
    </div>
  </div>

  <!-- Nav bar -->
  <div class="nav-bar">
    <div class="nav-item active" id="nav-nowplaying" onclick="switchTab('nowplaying')">
      <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle><polygon points="10 8 16 12 10 16 10 8" fill="currentColor" stroke="none"></polygon></svg>
      <span>Now Playing</span>
    </div>
    <div class="nav-item" id="nav-library" onclick="switchTab('library')">
      <svg viewBox="0 0 24 24"><path d="M9 18V5l12-2v13"></path><circle cx="6" cy="18" r="3"></circle><circle cx="18" cy="16" r="3"></circle></svg>
      <span>Library</span>
    </div>
  </div>

</div><!-- end phone -->

<script>
// Data
const songs = [
  { id:1, title:"Blinding Lights", artist:"The Weeknd", album:"After Hours", duration:200, emoji:"ðŸŒ†", grad:"linear-gradient(135deg,#e84393,#7b2ff7)", color:"#e84393" },
  { id:2, title:"Levitating", artist:"Dua Lipa", album:"Future Nostalgia", duration:203, emoji:"ðŸª", grad:"linear-gradient(135deg,#7b2ff7,#00d4ff)", color:"#7b2ff7" },
  { id:3, title:"Stay", artist:"The Kid LAROI", album:"F*CK LOVE 3", duration:141, emoji:"ðŸŒ™", grad:"linear-gradient(135deg,#1a1a2e,#e94560)", color:"#e94560" },
  { id:4, title:"Good 4 U", artist:"Olivia Rodrigo", album:"SOUR", duration:178, emoji:"ðŸŒ¸", grad:"linear-gradient(135deg,#ff6b6b,#ffd93d)", color:"#ff6b6b" },
  { id:5, title:"Peaches", artist:"Justin Bieber", album:"Justice", duration:198, emoji:"ðŸ‘", grad:"linear-gradient(135deg,#f7971e,#ffd200)", color:"#f7971e" },
  { id:6, title:"Industry Baby", artist:"Lil Nas X", album:"MONTERO", duration:212, emoji:"ðŸ”¥", grad:"linear-gradient(135deg,#fc3c44,#ff6b35)", color:"#fc3c44" },
  { id:7, title:"Heat Waves", artist:"Glass Animals", album:"Dreamland", duration:238, emoji:"ðŸŒŠ", grad:"linear-gradient(135deg,#0f3443,#34e89e)", color:"#34e89e" },
  { id:8, title:"Save Your Tears", artist:"The Weeknd", album:"After Hours", duration:215, emoji:"ðŸ–¤", grad:"linear-gradient(135deg,#0f0c29,#302b63)", color:"#a855f7" },
  { id:9, title:"Montero", artist:"Lil Nas X", album:"MONTERO", duration:137, emoji:"âš¡", grad:"linear-gradient(135deg,#f953c6,#b91d73)", color:"#f953c6" },
  { id:10, title:"drivers license", artist:"Olivia Rodrigo", album:"SOUR", duration:242, emoji:"ðŸŒ§ï¸", grad:"linear-gradient(135deg,#1e3c72,#2a5298)", color:"#5a9fd4" },
];

let currentIdx = 0;
let isPlaying = false;
let currentTime = 0;
let liked = [];
let shuffle = false;
let repeat = false;
let volume = 0.8;
let timer = null;
let filteredSongs = [...songs];

function fmtTime(s) {
  const m = Math.floor(s/60), sec = Math.floor(s%60);
  return `${m}:${sec.toString().padStart(2,'0')}`;
}

function getSong() { return filteredSongs[currentIdx] || songs[currentIdx] || songs[0]; }

function renderSongList(list) {
  const container = document.getElementById('songList');
  container.innerHTML = list.map((s, i) => {
    const active = getSong().id === s.id;
    return `<div class="song-item" onclick="playSong(${i}, ${JSON.stringify(list.map(x=>x.id))})">
      <div class="song-art" style="background:${s.grad}">${s.emoji}</div>
      <div class="song-info">
        <div class="song-name ${active ? 'playing-now' : ''}">${s.title}</div>
        <div class="song-meta">${s.artist} Â· ${s.album}</div>
      </div>
      ${active && isPlaying ? `<div class="playing-bars"><span></span><span></span><span></span></div>` : `<span class="song-duration">${fmtTime(s.duration)}</span>`}
    </div>`;
  }).join('');
}

function updateNowPlaying() {
  const s = getSong();
  if (!s) return;
  document.getElementById('npArt').textContent = s.emoji;
  document.getElementById('npArt').style.background = s.grad;
  document.getElementById('npTitle').textContent = s.title;
  document.getElementById('npArtist').textContent = s.artist;
  document.getElementById('totalTime').textContent = fmtTime(s.duration);
  // Ambient
  document.getElementById('ambient').style.background = s.grad;
  // Heart
  document.getElementById('heartBtn').classList.toggle('liked', liked.includes(s.id));
  // Dynamic island
  document.getElementById('diArt').textContent = s.emoji;
  document.getElementById('diArt').style.background = s.grad;
  document.getElementById('diTitle').textContent = s.title;
  document.getElementById('diArtist').textContent = s.artist;
  // Mini
  document.getElementById('miniArt').textContent = s.emoji;
  document.getElementById('miniArt').style.background = s.grad;
  document.getElementById('miniTitle').textContent = s.title;
  document.getElementById('miniArtist').textContent = s.artist;
}

function updateProgress() {
  const s = getSong();
  if (!s) return;
  const pct = (currentTime / s.duration) * 100;
  document.getElementById('progressFill').style.width = pct + '%';
  document.getElementById('currentTime').textContent = fmtTime(currentTime);
}

function tick() {
  const s = getSong();
  if (!s) return;
  currentTime += 0.5;
  if (currentTime >= s.duration) {
    if (repeat) { currentTime = 0; }
    else { nextSong(); return; }
  }
  updateProgress();
}

function startTimer() {
  clearInterval(timer);
  timer = setInterval(tick, 500);
}

function stopTimer() { clearInterval(timer); }

function togglePlay() {
  isPlaying = !isPlaying;
  const playIcon = `<polygon points="5 3 19 12 5 21 5 3" fill="#000" stroke="none"></polygon>`;
  const pauseIcon = `<rect x="6" y="4" width="4" height="16" fill="#000" stroke="none"></rect><rect x="14" y="4" width="4" height="16" fill="#000" stroke="none"></rect>`;
  const miniPlayIcon = `<polygon points="5 3 19 12 5 21 5 3" fill="currentColor" stroke="none"></polygon>`;
  const miniPauseIcon = `<rect x="6" y="4" width="4" height="16" fill="currentColor" stroke="none"></rect><rect x="14" y="4" width="4" height="16" fill="currentColor" stroke="none"></rect>`;

  document.getElementById('playIcon').innerHTML = isPlaying ? pauseIcon : playIcon;
  document.getElementById('miniPlayIcon').innerHTML = isPlaying ? miniPauseIcon : miniPlayIcon;
  document.getElementById('npArt').classList.toggle('playing', isPlaying);
  document.getElementById('dynamicIsland').classList.toggle('playing', isPlaying);

  if (isPlaying) startTimer();
  else stopTimer();

  renderSongList(filteredSongs);
}

function playAtIndex(idx) {
  currentIdx = idx;
  currentTime = 0;
  updateNowPlaying();
  updateProgress();
  if (!isPlaying) togglePlay();
  else { stopTimer(); startTimer(); renderSongList(filteredSongs); }
}

function playSong(i, idList) {
  // Find index in filteredSongs
  const id = idList ? idList[i] : filteredSongs[i].id;
  const idx = filteredSongs.findIndex(s => s.id === id);
  if (idx === -1) return;
  currentIdx = idx;
  currentTime = 0;
  updateNowPlaying();
  updateProgress();
  if (!isPlaying) { isPlaying = false; togglePlay(); }
  else { stopTimer(); startTimer(); }
  renderSongList(filteredSongs);
}

function nextSong() {
  if (shuffle) {
    let n = Math.floor(Math.random() * filteredSongs.length);
    if (n === currentIdx && filteredSongs.length > 1) n = (n+1) % filteredSongs.length;
    currentIdx = n;
  } else {
    currentIdx = (currentIdx + 1) % filteredSongs.length;
  }
  currentTime = 0;
  updateNowPlaying();
  updateProgress();
  if (isPlaying) { stopTimer(); startTimer(); }
  renderSongList(filteredSongs);
}

function prevSong() {
  if (currentTime > 3) { currentTime = 0; updateProgress(); return; }
  currentIdx = (currentIdx - 1 + filteredSongs.length) % filteredSongs.length;
  currentTime = 0;
  updateNowPlaying();
  updateProgress();
  if (isPlaying) { stopTimer(); startTimer(); }
  renderSongList(filteredSongs);
}

function seekTo(e) {
  const bar = e.currentTarget;
  const pct = e.offsetX / bar.offsetWidth;
  const s = getSong();
  currentTime = pct * s.duration;
  updateProgress();
}

function toggleLike() {
  const id = getSong().id;
  if (liked.includes(id)) liked = liked.filter(x => x !== id);
  else liked.push(id);
  document.getElementById('heartBtn').classList.toggle('liked', liked.includes(id));
}

function toggleShuffle() {
  shuffle = !shuffle;
  document.getElementById('shuffleBtn').style.opacity = shuffle ? '1' : '0.5';
  document.getElementById('shuffleBtn').style.color = shuffle ? 'var(--accent)' : '';
}

function toggleRepeat() {
  repeat = !repeat;
  document.getElementById('repeatBtn').style.opacity = repeat ? '1' : '0.5';
  document.getElementById('repeatBtn').style.color = repeat ? 'var(--accent)' : '';
}

function setVolume(v) { volume = v / 100; }

function filterSongs(q) {
  q = q.toLowerCase();
  filteredSongs = q ? songs.filter(s => s.title.toLowerCase().includes(q) || s.artist.toLowerCase().includes(q)) : [...songs];
  renderSongList(filteredSongs);
}

function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

  document.querySelector(`[data-view="${tab}"]`)?.classList.add('active');
  document.getElementById(`view-${tab}`)?.classList.add('active');
  document.getElementById(`nav-${tab}`)?.classList.add('active');

  const miniPlayer = document.getElementById('miniPlayer');
  miniPlayer.classList.toggle('hidden', tab === 'nowplaying' || currentIdx === undefined);

  renderSongList(filteredSongs);
}

// Tab clicks
document.querySelectorAll('.tab').forEach(t => {
  t.addEventListener('click', () => switchTab(t.dataset.view));
});

function shareTrack() {
  const s = getSong();
  alert(`Sharing: "${s.title}" by ${s.artist}`);
}
function showQueue() {
  switchTab('library');
}

// Init
updateNowPlaying();
renderSongList(filteredSongs);

// Auto-select first song display
updateProgress();
</script>
</body>
</html>
